'use strict';

$(function () {
    var _count = $('#page').data('count');
    var $list = $('#list');
    layui.use('laypage', function () {
        var laypage = layui.laypage;
        laypage.render({
            elem: 'page',
            count: parseInt(_count),
            limit: 10,
            jump: function jump(obj, first) {
                $list.empty();
                loading(true);
                $.ajax({
                    type: "Get",
                    url: "/getDownFileList",
                    dataType: "json",
                    data: {
                        limit: obj.limit,
                        page: obj.curr
                    },
                    success: function success(r) {
                        if (r.ok === 200) {
                            var html = '';
                            r.data.map(function (item, index) {
                                html += '<div class="item clearfix">\n                                    <svg class="icon" aria-hidden="true">\n                                        <use xlink:href="#icon-' + item.type + '"></use>\n                                    </svg>\n                                    <p>' + (r.lang === 'zh' ? item.title : item.entitle) + '</p>\n                                    <div class="right-box">\n                                        <span>' + (item.type === 'othe' ? 'other' : item.type) + '</span>\n                                        <span>' + item.size + '</span>\n                                        <a href="' + item.filepath + '?attname=" download>' + (r.lang === 'zh' ? '下载' : 'Download') + '</a>\n                                    </div>\n                                </div>';
                            });
                            $list.append(html);
                            loading();
                        } else {
                            alert(r.msg);
                        }
                    }
                });
            }
        });
    });
});

function loading(state) {
    var $loading = $('.loading-layer');
    if (state) {
        $loading.removeClass('close');
    } else {
        $loading.addClass('close');
    }
}