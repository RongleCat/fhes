'use strict';

$(function () {
    var $nav = $('.left-nav');
    var $content = $('.content-block');
    var top = void 0;
    var _block = [];
    var bodyHeight = $(document).height();
    var windowHeight = $(window).height();
    var stopHeight = bodyHeight - windowHeight - 720;

    $content.map(function (index, item) {
        _block.push($(item).offset().top);
    });
    $(window).on('hashchange', function (e) {
        var hash = window.location.hash;
        $(hash + '_hash').addClass('active').siblings().removeClass('active');
        // setNavTop($nav)
    });
    setTimeout(function () {
        if (window.location.hash) {
            top = $(window.location.hash).offset().top;
            $(window).scrollTop(top);
            $(window.location.hash + '_hash').addClass('active').siblings().removeClass('active');
            setNavTop($nav);
        }
    }, 10);
    $(window).on('scroll', function (e) {
        var scrollY = $(window).scrollTop();
        $nav.find('li').eq(limit(_block, scrollY + 300)).addClass('active').siblings().removeClass('active');
        if (scrollY <= 400) {
            $nav.css({ 'top': '0' });
        } else if (scrollY >= stopHeight) {
            $nav.css({ 'top': stopHeight + 'px' });
        } else {
            setNavTop($nav);
        }
    });
});

function setNavTop(el) {
    var windowTop = $(window).scrollTop();
    var mainTop = $('.other-main').offset().top;
    el.css('top', windowTop - mainTop + 100 + 'px');
}

function limit(arr, num) {
    var newArr = [];
    arr.map(function (x) {
        newArr.push(Math.abs(x - num));
    });
    var index = newArr.indexOf(Math.min.apply(null, newArr));
    return index;
}