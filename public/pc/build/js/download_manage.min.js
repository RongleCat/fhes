"use strict";var fileTypes=["othe","zip","avi","swf","wav","txt","rmvb","xls","mkv","psd","exe","gif","pdf","mp4","ppt","png","mp3","jpg","doc"];function getFileType(e){var l=e.lastIndexOf(".");return e.substring(l+1,e.length)}function bytesToSize(e){if(0===e)return"0 B";var l=Math.floor(Math.log(e)/Math.log(1024));return(e/Math.pow(1024,l)).toPrecision(3)+["B","KB","MB","GB","TB","PB","EB","ZB","YB"][l]}$(function(){var e=layui.table,i={url:"/manage/getDownFileList",elem:"#demo",id:"demo",page:{curr:1},limit:10,limits:[10,15,20],height:"full-200",where:{},cols:[[{field:"id",title:"ID",width:80},{field:"title",title:"中文标题"},{field:"entitle",title:"英文标题"},{field:"size",title:"文件大小"},{field:"type",title:"文件类型"},{fixed:"right",align:"center",title:"操作",width:180,field:"filepath",templet:function(e){return'<a class="layui-btn layui-btn-primary layui-btn-xs" href="'+e.filepath+'?attname=" download>下载</a>\n                    <a class="layui-btn layui-btn-danger layui-btn-xs" lay-event="del">删除</a>'}}]]},t=e.render(i);$("#btn-search").on("click",function(e){var l=$("#ipt-keyword").val();i.where.keyword=l,t.reload(i)}),$("#btn-clear").on("click",function(e){delete i.where.keyword,$("#ipt-keyword").val(""),t.reload(i)}),$("#ipt-keyword").on("keypress",function(e){13===e.keyCode&&$("#btn-search").click()}),e.on("tool(demo)",function(l){var i=l.data,e=l.event;l.tr;"del"===e?layer.confirm("真的要删除这个文件吗？",function(e){layer.close(e),$.ajax({type:"POST",url:"/manage/deleteDownFile",dataType:"json",data:{id:i.id,filepath:i.filepath},success:function(e){200===e.ok?l.del():layer.msg(e.msg,function(){})}})}):$.ajax({type:"GET",url:"/manage/downFile",dataType:"json",data:{id:i.id},success:function(e){console.log(e)}})}),layui.use("layer",function(){var t=layui.layer;$("#btn-addfile").on("click",function(){t.open({type:1,area:"500px",content:'<div class="addfile-container">\n                <form class="layui-form layui-form-pane">\n                    <div class="layui-form-item">\n                        <label class="layui-form-label">中文标题</label>\n                        <div class="layui-input-block">\n                            <input type="text" name="title" lay-verify="" placeholder="请输入中文标题" autocomplete="off" class="layui-input">\n                        </div>\n                    </div>\n                    <div class="layui-form-item">\n                        <label class="layui-form-label">英文标题</label>\n                        <div class="layui-input-block">\n                            <input type="text" name="entitle" lay-verify="" placeholder="请输入英文标题" autocomplete="off" class="layui-input">\n                        </div>\n                    </div>\n                    <div class="layui-form-item">\n                        <label class="layui-form-label upload-file">选择文件</label>\n                        <div class="layui-input-block cover">\n                            <div class="layui-upload-drag" id="upload-file">\n                                <i class="layui-icon"></i>\n                                <p>点击上传，或将文件拖拽到此处</p>\n                                <span></span>\n                            </div>\n                        </div>\n                    </div>\n                    <div class="layui-form-item btn-box">\n                        <button class="layui-btn" lay-submit lay-filter="submit" id="btn-submit">立即提交</button>\n                    </div>\n                </form>\n            </div>',success:function(e,l){var i=layui.upload,a={};i.render({elem:"#upload-file",url:"/manage/uploadDownFile",accept:"file",done:function(e,l,i){if(200===e.ok){var t=getFileType(e.result["x:filename"]);-1<fileTypes.indexOf(t)?a.type=t:a.type="xlsx"===t||"pptx"===t||"docx"===t?t.substring(0,3):"othe",a.size=bytesToSize(e.result["x:size"]),a.filepath=e.result.url,$("#upload-file").find("span").text("已上传 "+e.result.key)}else i()}}),layui.use("form",function(){layui.form.on("submit(submit)",function(e){return console.log(e),$.trim(e.field.title)?$.trim(e.field.entitle)?(a.title=e.field.title,a.entitle=e.field.entitle,a.filepath&&a.size&&a.type?(console.log(a),$.ajax({type:"POST",url:"/manage/addDownFile",dataType:"json",data:a,success:function(e){200===e.ok?location.reload():t.msg(e.msg)}})):t.msg("请上传文件！",function(){}),!1):(t.msg("英文标题不能为空",function(){}),!1):(t.msg("中文标题不能为空",function(){}),!1)})}),e.on("click","#btn-submit",function(){console.log(111)})}})})})});