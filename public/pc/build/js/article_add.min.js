"use strict";$(function(){var e=window.wangEditor,t=["head","bold","fontSize","fontName","italic","underline","strikeThrough","foreColor","backColor","link","list","justify","quote","image","table","undo","redo"],n=Qiniu.uploader({runtimes:"html5,flash,html4",browse_button:"upload-cover",uptoken_url:"/manage/uptoken",domain:"http://images.fhes.com/",filters:{mime_types:[{title:"图片文件",extensions:"jpg,gif,png,bmp"}]},max_file_size:"100mb",max_retries:3,dragdrop:!0,chunk_size:"4mb",auto_start:!0,init:{UploadProgress:function(e,t){$("#upload-cover").find("span").text("已上传 "+n.total.percent+"%")},FileUploaded:function(e,t,n){var o=e.getOption("domain")+$.parseJSON(n).key;0!=$(".img-cover").length?$(".img-cover")[0].src=o+"-mask":$("#upload-cover").find("p").text("点击/拖拽更换封面图片").end().before('<img src="'+o+'-mask" class="img-cover">')},Error:function(e,t,n){printLog("on Error")}}}),l=new e("#zhContent");l.customConfig.onfocus=function(){$(l.toolbarSelector).addClass("focus")},l.customConfig.onblur=function(){$(l.toolbarSelector).removeClass("focus")},l.customConfig.menus=t;var r=new e("#enContent");r.customConfig.onfocus=function(){$(r.toolbarSelector).addClass("focus")},r.customConfig.onblur=function(){$(r.toolbarSelector).removeClass("focus")},r.customConfig.menus=t,l.create(),r.create(),uploadInit(l),uploadInit(r),layui.use("form",function(){var e=layui.form;e.on("submit(submit)",function(e){var t=l.txt.html(),n=r.txt.html(),o=$(".img-cover").attr("src");for(var i in e.field)e.field[i]||delete e.field[i];if(!o)return layer.msg("请先上传封面图片"),!1;if(e.field.cover=o,l.txt.text()&&(e.field.content=t),r.txt.text()&&(e.field.encontent=n),$("#openEn")[0].checked){if(!e.field.title&&!e.field.entitle)return layer.msg("中文标题和英文标题不能都为空"),!1;if(e.field.entitle&&!e.field.encontent)return layer.msg("有英文标题必须有英文内容"),!1;e.field.encontent&&(e.field.entitle||layer.msg("有英文内容必须有英文标题"))}else if(!e.field.title)return layer.msg("标题不能为空"),!1;return e.field.title&&!e.field.content?layer.msg("有中文标题必须有中文内容"):e.field.content&&!e.field.title?layer.msg("有中文内容必须有中文标题"):($("#openEn")[0].checked||(delete e.field.encontent,delete e.field.entitle,delete e.field.ensubtitle),e.field.title&&e.field.entitle?e.field.language="11":e.field.title&&!e.field.entitle?e.field.language="10":e.field.language="01",$.ajax({type:"POST",url:"/manage/addarticle",dataType:"json",data:e.field,success:function(e){200===e.ok?targetParent("articleList"):alert(e.msg)}})),!1}),e.on("switch(addEn)",function(e){e.elem.checked?$(".en-block").fadeIn("fast"):$(".en-block").fadeOut("fast")})})});