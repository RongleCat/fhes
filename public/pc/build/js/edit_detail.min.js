"use strict";var fileurl=$("#upload-file").data("file"),url=location.href.split("/");$(function(){var e=window.wangEditor,t=["head","bold","fontSize","fontName","italic","underline","strikeThrough","foreColor","backColor","link","list","justify","quote","image","table","undo","redo"],o=layui.upload;o.render({elem:"#upload-cover",url:"/manage/uploadNewsCover",accept:"images",acceptMime:"image/*",done:function(e){200===e.ok&&(0!=$(".img-cover").length?$(".img-cover")[0].src=e.result.url+"-mask":$("#upload-cover").find("p").text("点击/拖拽更换视频封面图片").end().before('<img src="'+e.result.url+'-mask" class="img-cover">'))}}),o.render({elem:"#upload-file",url:"/manage/uploadDownFile",accept:"file",done:function(e,t,o){200===e.ok?(console.log(e),fileurl=e.result.url,$("#upload-file").find("span").text("已上传 "+e.result.key)):o()}});var n=new e("#zhContent");n.customConfig.onfocus=function(){$(n.toolbarSelector).addClass("focus")},n.customConfig.onblur=function(){$(n.toolbarSelector).removeClass("focus")},n.customConfig.menus=t;var i=new e("#enContent");i.customConfig.onfocus=function(){$(i.toolbarSelector).addClass("focus")},i.customConfig.onblur=function(){$(i.toolbarSelector).removeClass("focus")},i.customConfig.menus=t,n.create(),i.create(),uploadInit(n),uploadInit(i),layui.use("form",function(){var e=layui.form;$("#btn-submit-top").on("click",function(){$("#btn-submit").click()}),$("#btn-reset-top").on("click",function(){$("#btn-reset").click()}),e.on("submit(submit)",function(e){var t=n.txt.html(),o=i.txt.html(),l=$(".img-cover").attr("src");return e.field.id=url[url.length-1],console.log(e.field),e.field.videocover=l||"",e.field.file=fileurl||"",e.field.video&&!l?(layer.msg("必须添加视频封面图片",function(){}),!1):(n.txt.text()&&(e.field.content=t),i.txt.text()&&(e.field.encontent=o),e.field.title?e.field.entitle?e.field.content?e.field.encontent?$.ajax({type:"POST",url:"/manage/editdetail",dataType:"json",data:e.field,success:function(e){200===e.ok?targetParent("/manage",!0):alert(e.msg)}}):layer.msg("英文内容不能为空",function(){}):layer.msg("中文内容不能为空",function(){}):layer.msg("英文标题不能为空",function(){}):layer.msg("中文标题不能为空",function(){}),!1)})}),$("#btn-reset").on("click",function(e){e.preventDefault(),$('input[type="text"]').val(""),n.txt.clear(),i.txt.clear(),fileurl=null,$("#upload-file span").text(""),$(".img-cover").remove()}),$("#btn-delete-file").on("click",function(e){e.preventDefault(),fileurl=null,$("#upload-file span").text("")}),$("#btn-delete-cover").on("click",function(e){e.preventDefault(),$(".img-cover").remove()})});