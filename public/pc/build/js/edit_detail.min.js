"use strict";var fileurl=$("#upload-file").data("file"),url=location.href.split("/");function bytesToSize(e){if(0===e)return"0 B";var t=Math.floor(Math.log(e)/Math.log(1024));return(e/Math.pow(1024,t)).toPrecision(3)+["B","KB","MB","GB","TB","PB","EB","ZB","YB"][t]}$(function(){var e=window.wangEditor,t=["head","bold","fontSize","fontName","italic","underline","strikeThrough","foreColor","backColor","link","list","justify","quote","image","table","undo","redo"],o=(layui.upload,Qiniu.uploader({runtimes:"html5,flash,html4",browse_button:"upload-cover",uptoken_url:"/manage/uptoken",domain:"http://images.fhes.com/",filters:{mime_types:[{title:"图片文件",extensions:"jpg,gif,png,bmp"}]},max_file_size:"100mb",max_retries:3,dragdrop:!0,chunk_size:"4mb",auto_start:!0,init:{UploadProgress:function(e,t){$("#upload-cover").find("span").text("已上传 "+o.total.percent+"%")},FileUploaded:function(e,t,o){var n=e.getOption("domain")+$.parseJSON(o).key;0!=$(".img-cover").length?$(".img-cover")[0].src=n+"-mask":$("#upload-cover").find("p").text("点击/拖拽更换视频封面图片").end().before('<img src="'+n+'-mask" class="img-cover">')},Error:function(e,t,o){printLog("on Error")}}}));setTimeout(function(){var o=Qiniu.uploader({runtimes:"html5,flash,html4",browse_button:"upload-file",uptoken_url:"/manage/uptoken?type=file",domain:"http://p9gz545fl.bkt.clouddn.com/",max_file_size:"100mb",max_retries:3,dragdrop:!0,chunk_size:"4mb",auto_start:!0,init:{FilesAdded:function(e,t){console.log(e)},UploadProgress:function(e,t){$("#upload-file").find("span").text("已上传 "+o.total.percent+"%")},FileUploaded:function(e,t,o){var n=e.getOption("domain"),i=$.parseJSON(o),l=n+i.key;console.log(i),fileurl=l,$("#upload-file").find("span").text("已上传 "+i.key),post.size=bytesToSize(t.size),post.filepath=l},Error:function(e,t,o){printLog("on Error")}}})},100);var i=new e("#zhContent");i.customConfig.onfocus=function(){$(i.toolbarSelector).addClass("focus")},i.customConfig.onblur=function(){$(i.toolbarSelector).removeClass("focus")},i.customConfig.menus=t;var l=new e("#enContent");l.customConfig.onfocus=function(){$(l.toolbarSelector).addClass("focus")},l.customConfig.onblur=function(){$(l.toolbarSelector).removeClass("focus")},l.customConfig.menus=t,i.create(),l.create(),uploadInit(i),uploadInit(l),layui.use("form",function(){var e=layui.form;$("#btn-submit-top").on("click",function(){$("#btn-submit").click()}),$("#btn-reset-top").on("click",function(){$("#btn-reset").click()}),e.on("submit(submit)",function(e){var t=i.txt.html(),o=l.txt.html(),n=$(".img-cover").attr("src");return e.field.id=url[url.length-1],console.log(e.field),e.field.videocover=n||"",e.field.file=fileurl||"",e.field.video&&!n?(layer.msg("必须添加视频封面图片",function(){}),!1):(i.txt.text()&&(e.field.content=t),l.txt.text()&&(e.field.encontent=o),e.field.title?e.field.entitle?e.field.content?e.field.encontent?$.ajax({type:"POST",url:"/manage/editdetail",dataType:"json",data:e.field,success:function(e){200===e.ok?targetParent("/manage",!0):alert(e.msg)}}):layer.msg("英文内容不能为空",function(){}):layer.msg("中文内容不能为空",function(){}):layer.msg("英文标题不能为空",function(){}):layer.msg("中文标题不能为空",function(){}),!1)})}),$("#btn-reset").on("click",function(e){e.preventDefault(),$('input[type="text"]').val(""),i.txt.clear(),l.txt.clear(),fileurl=null,$("#upload-file span").text(""),$(".img-cover").remove()}),$("#btn-delete-file").on("click",function(e){e.preventDefault(),fileurl=null,$("#upload-file span").text("")}),$("#btn-delete-cover").on("click",function(e){e.preventDefault(),$(".img-cover").remove()})});