'use strict';

$(function () {
    var $nav = $('.left-nav');
    var $content = $('.content-block');
    var top = void 0;
    var _block = [];

    $content.map(function (index, item) {
        _block.push($(item).offset().top);
    });
    $(window).on('hashchange', function (e) {
        var hash = window.location.hash;
        $(hash + '_hash').addClass('active').siblings().removeClass('active');
        // setNavTop($nav)
    });
    setTimeout(function () {
        if (window.location.hash) {
            top = $(window.location.hash).offset().top;
            $(window).scrollTop(top);
            $(window.location.hash + '_hash').addClass('active').siblings().removeClass('active');
            setNavTop($nav);
        }
    }, 10);
    $(window).on('scroll', function (e) {
        var scrollY = $(window).scrollTop();
        $nav.find('li').eq(limit(_block, scrollY + 300)).addClass('active').siblings().removeClass('active');
        if (scrollY <= 400) {
            $nav.css('top', '0px');
        } else {
            setNavTop($nav);
        }
    });

    var $powerNav = $('.img-view-nav');
    var $powerContent = $('.img-view-content');
    $powerNav.on('click', '.item', function (e) {
        var _index = $(this).index();
        $(this).addClass('active').siblings().removeClass('active');
        if (_index === 2) {
            $powerNav.find('.item-01').addClass('bottom');
        } else {
            $powerNav.find('.item-01').removeClass('bottom');
        }
        $powerContent.find('.item').removeClass('active').eq(_index).addClass('active');
    });
    window.onload = function (e) {
        var map = new BMap.Map("map");
        var point = new BMap.Point(121.660293, 29.889404);
        map.centerAndZoom(point, 17);
        var marker = new BMap.Marker(point); // 创建标注
        map.addOverlay(marker); // 将标注添加到地图中
        marker.setAnimation(BMAP_ANIMATION_BOUNCE); //跳动的动画
    };
});

function setNavTop(el) {
    var windowTop = $(window).scrollTop();
    var mainTop = $('.other-main').offset().top;
    el.css('top', windowTop - mainTop + 100 + 'px');
}

function limit(arr, num) {
    var newArr = [];
    arr.map(function (x) {
        newArr.push(Math.abs(x - num));
    });
    var index = newArr.indexOf(Math.min.apply(null, newArr));
    return index;
}