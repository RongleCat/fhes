"use strict";var fileurl=$("#upload-file").data("file"),url=location.href.split("/"),_id=null,classid=null,classname=null;function bytesToSize(e){if(0===e)return"0 B";var t=Math.floor(Math.log(e)/Math.log(1024));return(e/Math.pow(1024,t)).toPrecision(3)+["B","KB","MB","GB","TB","PB","EB","ZB","YB"][t]}-1==url.indexOf("adderoduct")&&(_id=url[url.length-1]),$(function(){var e=window.wangEditor,t=["head","bold","fontSize","fontName","italic","underline","strikeThrough","foreColor","backColor","link","list","justify","quote","image","table","undo","redo"],o=(layui.upload,Qiniu.uploader({runtimes:"html5,flash,html4",browse_button:"upload-cover",uptoken_url:"/manage/uptoken",domain:"http://download.fhes.com/",filters:{mime_types:[{title:"图片文件",extensions:"jpg,gif,png,bmp"}]},max_file_size:"100mb",max_retries:3,dragdrop:!0,chunk_size:"4mb",auto_start:!0,init:{UploadProgress:function(e,t){$("#upload-cover").find("span").text("已上传 "+o.total.percent+"%")},FileUploaded:function(e,t,o){var n=e.getOption("domain")+$.parseJSON(o).key;0!=$(".img-cover").length?$(".img-cover")[0].src=n+"":$("#upload-cover").find("p").text("点击/拖拽更换产品主图图片").end().before('<img src="'+n+'" class="img-cover">')},Error:function(e,t,o){printLog("on Error")}}})),n=Qiniu.uploader({runtimes:"html5,flash,html4",browse_button:"upload-videocover",uptoken_url:"/manage/uptoken",domain:"http://download.fhes.com/",filters:{mime_types:[{title:"图片文件",extensions:"jpg,gif,png,bmp"}]},max_file_size:"100mb",max_retries:3,dragdrop:!0,chunk_size:"4mb",auto_start:!0,init:{UploadProgress:function(e,t){$("#upload-videocover").find("span").text("已上传 "+n.total.percent+"%")},FileUploaded:function(e,t,o){var n=e.getOption("domain")+$.parseJSON(o).key;0!=$(".img-videocover").length?$(".img-videocover")[0].src=n+"":$("#upload-videocover").find("p").text("点击/拖拽更换视频封面图片").end().before('<img src="'+n+'" class="img-videocover">')},Error:function(e,t,o){printLog("on Error")}}});setTimeout(function(){var o=Qiniu.uploader({runtimes:"html5,flash,html4",browse_button:"upload-file",uptoken_url:"/manage/uptoken?type=file",domain:"http://download.fhes.com/",max_file_size:"100mb",max_retries:3,dragdrop:!0,chunk_size:"4mb",auto_start:!0,init:{FilesAdded:function(e,t){console.log(e)},UploadProgress:function(e,t){$("#upload-file").find("span").text("已上传 "+o.total.percent+"%")},FileUploaded:function(e,t,o){var n=e.getOption("domain"),l=$.parseJSON(o),i=n+l.key;console.log(l),fileurl=i,$("#upload-file").find("span").text("已上传 "+l.key),post.size=bytesToSize(t.size),post.filepath=i},Error:function(e,t,o){printLog("on Error")}}})},100);var f=new e("#zhContent");f.customConfig.onfocus=function(){$(f.toolbarSelector).addClass("focus")},f.customConfig.onblur=function(){$(f.toolbarSelector).removeClass("focus")},f.customConfig.menus=t;var d=new e("#zhStyle");d.customConfig.onfocus=function(){$(d.toolbarSelector).addClass("focus")},d.customConfig.onblur=function(){$(d.toolbarSelector).removeClass("focus")},d.customConfig.menus=t;var m=new e("#zhRange");m.customConfig.onfocus=function(){$(m.toolbarSelector).addClass("focus")},m.customConfig.onblur=function(){$(m.toolbarSelector).removeClass("focus")},m.customConfig.menus=t;var p=new e("#zhParam");p.customConfig.onfocus=function(){$(p.toolbarSelector).addClass("focus")},p.customConfig.onblur=function(){$(p.toolbarSelector).removeClass("focus")},p.customConfig.menus=t;var g=new e("#enContent");g.customConfig.onfocus=function(){$(g.toolbarSelector).addClass("focus")},g.customConfig.onblur=function(){$(g.toolbarSelector).removeClass("focus")},g.customConfig.menus=t;var v=new e("#enStyle");v.customConfig.onfocus=function(){$(v.toolbarSelector).addClass("focus")},v.customConfig.onblur=function(){$(v.toolbarSelector).removeClass("focus")},v.customConfig.menus=t;var b=new e("#enRange");b.customConfig.onfocus=function(){$(b.toolbarSelector).addClass("focus")},b.customConfig.onblur=function(){$(b.toolbarSelector).removeClass("focus")},b.customConfig.menus=t;var x=new e("#enParam");x.customConfig.onfocus=function(){$(x.toolbarSelector).addClass("focus")},x.customConfig.onblur=function(){$(x.toolbarSelector).removeClass("focus")},x.customConfig.menus=t,f.create(),d.create(),m.create(),p.create(),g.create(),v.create(),b.create(),x.create(),uploadInit(f),uploadInit(d),uploadInit(m),uploadInit(p),uploadInit(g),uploadInit(v),uploadInit(b),uploadInit(x),layui.use("form",function(){var e=layui.form;$("#btn-submit-top").on("click",function(){$("#btn-submit").click()}),$("#btn-reset-top").on("click",function(){$("#btn-reset").click()}),e.on("select(class)",function(o){$(o.elem).find("option").map(function(e,t){$(t).attr("value")==o.value&&(window.classname=$(t).text())}),classid=o.value}),e.on("submit(submit)",function(e){var t=f.txt.html(),o=d.txt.html(),n=m.txt.html(),l=p.txt.html(),i=g.txt.html(),a=v.txt.html(),r=b.txt.html(),s=x.txt.html(),c=$(".img-cover").attr("src"),u=$(".img-videocover").attr("src");return _id&&(e.field.id=_id),console.log(e.field),c?(e.field.cover=c,e.field.videocover=u||"",e.field.file=fileurl||"",e.field.video&&!u?(layer.msg("必须添加视频封面图片",function(){}),!1):classid?(e.field.classid=classid,e.field.classname=classname,f.txt.text()&&(e.field.content=t),d.txt.text()&&(e.field.style=o),m.txt.text()&&(e.field.range=n),p.txt.text()&&(e.field.param=l),g.txt.text()&&(e.field.encontent=i),v.txt.text()&&(e.field.enstyle=a),b.txt.text()&&(e.field.enrange=r),x.txt.text()&&(e.field.enparam=s),e.field.title?e.field.entitle?e.field.content?e.field.encontent?e.field.style&&!e.field.enstyle?layer.msg("英文产品特点不能为空",function(){}):!e.field.style&&e.field.enstyle?layer.msg("中文产品特点不能为空",function(){}):e.field.range&&!e.field.enrange?layer.msg("英文应用范围不能为空",function(){}):!e.field.range&&e.field.enrange?layer.msg("中文应用范围不能为空",function(){}):e.field.param&&!e.field.enparam?layer.msg("英文技术参数不能为空",function(){}):!e.field.param&&e.field.enparam?layer.msg("中文技术参数不能为空",function(){}):_id?$.ajax({type:"POST",url:"/manage/editproduct",dataType:"json",data:e.field,success:function(e){200===e.ok?targetParent("productmanage"):alert(e.msg)}}):$.ajax({type:"POST",url:"/manage/addproduct",dataType:"json",data:e.field,success:function(e){200===e.ok?targetParent("productmanage"):alert(e.msg)}}):layer.msg("英文产品简介不能为空",function(){}):layer.msg("中文产品简介不能为空",function(){}):layer.msg("英文标题不能为空",function(){}):layer.msg("中文标题不能为空",function(){}),!1):(layer.msg("必须选择产品所属分类",function(){}),!1)):(layer.msg("必须添加产品主图图片",function(){}),!1)})}),$("#btn-reset").on("click",function(e){e.preventDefault(),$('input[type="text"]').val(""),f.txt.clear(),d.txt.clear(),m.txt.clear(),p.txt.clear(),g.txt.clear(),v.txt.clear(),b.txt.clear(),x.txt.clear(),fileurl=null,$("#upload-file span").text(""),$(".img-videocover").remove(),$(".img-cover").remove(),classid=null}),$("#btn-delete-file").on("click",function(e){e.preventDefault(),fileurl=null,$("#upload-file span").text("")}),$("#btn-delete-cover").on("click",function(e){e.preventDefault(),$(".img-cover").remove()}),$("#btn-delete-videocover").on("click",function(e){e.preventDefault(),$(".img-videocover").remove()})});