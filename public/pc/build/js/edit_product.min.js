"use strict";var fileurl=$("#upload-file").data("file"),url=location.href.split("/"),_id=null,classid=null,classname=null;function bytesToSize(e){if(0===e)return"0 B";var t=Math.floor(Math.log(e)/Math.log(1024));return(e/Math.pow(1024,t)).toPrecision(3)+["B","KB","MB","GB","TB","PB","EB","ZB","YB"][t]}-1==url.indexOf("adderoduct")&&(_id=url[url.length-1]),$(function(){var e=window.wangEditor,t=["head","bold","fontSize","fontName","italic","underline","strikeThrough","foreColor","backColor","link","list","justify","quote","image","table","undo","redo"],o=(layui.upload,Qiniu.uploader({runtimes:"html5,flash,html4",browse_button:"upload-cover",uptoken_url:"/manage/uptoken",domain:"http://download.fhes.com/",filters:{mime_types:[{title:"图片文件",extensions:"jpg,gif,png,bmp"}]},max_file_size:"100mb",max_retries:3,dragdrop:!0,chunk_size:"4mb",auto_start:!0,init:{UploadProgress:function(e,t){$("#upload-cover").find("span").text("已上传 "+o.total.percent+"%")},FileUploaded:function(e,t,o){var n=e.getOption("domain")+$.parseJSON(o).key;0!=$(".img-cover").length?$(".img-cover")[0].src=n+"":$("#upload-cover").find("p").text("点击/拖拽更换产品主图图片").end().before('<img src="'+n+'" class="img-cover">')},Error:function(e,t,o){printLog("on Error")}}})),n=Qiniu.uploader({runtimes:"html5,flash,html4",browse_button:"upload-videocover",uptoken_url:"/manage/uptoken",domain:"http://download.fhes.com/",filters:{mime_types:[{title:"图片文件",extensions:"jpg,gif,png,bmp"}]},max_file_size:"100mb",max_retries:3,dragdrop:!0,chunk_size:"4mb",auto_start:!0,init:{UploadProgress:function(e,t){$("#upload-videocover").find("span").text("已上传 "+n.total.percent+"%")},FileUploaded:function(e,t,o){var n=e.getOption("domain")+$.parseJSON(o).key;0!=$(".img-videocover").length?$(".img-videocover")[0].src=n+"":$("#upload-videocover").find("p").text("点击/拖拽更换视频封面图片").end().before('<img src="'+n+'" class="img-videocover">')},Error:function(e,t,o){printLog("on Error")}}});setTimeout(function(){var o=Qiniu.uploader({runtimes:"html5,flash,html4",browse_button:"upload-file",uptoken_url:"/manage/uptoken?type=file",domain:"http://download.fhes.com/",max_file_size:"100mb",max_retries:3,dragdrop:!0,chunk_size:"4mb",auto_start:!0,init:{FilesAdded:function(e,t){console.log(e)},UploadProgress:function(e,t){$("#upload-file").find("span").text("已上传 "+o.total.percent+"%")},FileUploaded:function(e,t,o){var n=e.getOption("domain"),i=$.parseJSON(o),l=n+i.key;console.log(i),fileurl=l,$("#upload-file").find("span").text("已上传 "+i.key),post.size=bytesToSize(t.size),post.filepath=l},Error:function(e,t,o){printLog("on Error")}}})},100);var l=new e("#zhContent");l.customConfig.onfocus=function(){$(l.toolbarSelector).addClass("focus")},l.customConfig.onblur=function(){$(l.toolbarSelector).removeClass("focus")},l.customConfig.menus=t;var r=new e("#enContent");r.customConfig.onfocus=function(){$(r.toolbarSelector).addClass("focus")},r.customConfig.onblur=function(){$(r.toolbarSelector).removeClass("focus")},r.customConfig.menus=t,l.create(),r.create(),uploadInit(l),uploadInit(r),layui.use("form",function(){var e=layui.form;$("#btn-submit-top").on("click",function(){$("#btn-submit").click()}),$("#btn-reset-top").on("click",function(){$("#btn-reset").click()}),e.on("select(class)",function(o){$(o.elem).find("option").map(function(e,t){$(t).attr("value")==o.value&&(window.classname=$(t).text())}),classid=o.value}),e.on("submit(submit)",function(e){var t=l.txt.html(),o=r.txt.html(),n=$(".img-cover").attr("src"),i=$(".img-videocover").attr("src");return _id&&(e.field.id=_id),console.log(e.field),n?(e.field.cover=n,e.field.videocover=i||"",e.field.file=fileurl||"",e.field.video&&!i?(layer.msg("必须添加视频封面图片",function(){}),!1):classid?(e.field.classid=classid,e.field.classname=classname,l.txt.text()&&(e.field.content=t),r.txt.text()&&(e.field.encontent=o),e.field.title?e.field.entitle?e.field.content?e.field.encontent?_id?$.ajax({type:"POST",url:"/manage/editproduct",dataType:"json",data:e.field,success:function(e){200===e.ok?targetParent("productmanage"):alert(e.msg)}}):$.ajax({type:"POST",url:"/manage/addproduct",dataType:"json",data:e.field,success:function(e){200===e.ok?targetParent("productmanage"):alert(e.msg)}}):layer.msg("英文内容不能为空",function(){}):layer.msg("中文内容不能为空",function(){}):layer.msg("英文标题不能为空",function(){}):layer.msg("中文标题不能为空",function(){}),!1):(layer.msg("必须选择产品所属分类",function(){}),!1)):(layer.msg("必须添加产品主图图片",function(){}),!1)})}),$("#btn-reset").on("click",function(e){e.preventDefault(),$('input[type="text"]').val(""),l.txt.clear(),r.txt.clear(),fileurl=null,$("#upload-file span").text(""),$(".img-videocover").remove(),$(".img-cover").remove(),classid=null}),$("#btn-delete-file").on("click",function(e){e.preventDefault(),fileurl=null,$("#upload-file span").text("")}),$("#btn-delete-cover").on("click",function(e){e.preventDefault(),$(".img-cover").remove()}),$("#btn-delete-videocover").on("click",function(e){e.preventDefault(),$(".img-videocover").remove()})});